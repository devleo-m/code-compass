Aula 6: Compara√ß√µes de Igualdade em JavaScript - Dominando os Operadores de Compara√ß√£o
üîç Objetivos de Aprendizado
- Compreender os diferentes tipos de compara√ß√£o de igualdade
- Dominar os operadores ==, === e Object.is()
- Entender os algoritmos de igualdade (isLooselyEqual, isStrictlyEqual, SameValue, SameValueZero)
- Aplicar as compara√ß√µes corretas em diferentes cen√°rios
- Evitar armadilhas comuns em compara√ß√µes
- Implementar compara√ß√µes personalizadas quando necess√°rio
- Otimizar performance com compara√ß√µes adequadas
- Seguir boas pr√°ticas em c√≥digo de produ√ß√£o

üîç O Que S√£o Compara√ß√µes de Igualdade?
Operadores de compara√ß√£o s√£o usados em declara√ß√µes l√≥gicas para determinar igualdade ou diferen√ßa entre vari√°veis ou valores. Em JavaScript, temos diferentes n√≠veis de rigor na compara√ß√£o, cada um com suas caracter√≠sticas espec√≠ficas.

**Tipos de Compara√ß√£o:**

| Operador | Nome | Comportamento | Type Coercion |
|----------|------|---------------|---------------|
| `==` | Igualdade Solta | Compara valores ap√≥s convers√£o | Sim |
| `===` | Igualdade Estrita | Compara valores e tipos | N√£o |
| `Object.is()` | Igualdade Mesmo Valor | Compara valores id√™nticos | N√£o |

**Por que diferentes tipos de compara√ß√£o?**
- **Flexibilidade**: `==` permite compara√ß√µes mais flex√≠veis
- **Precis√£o**: `===` evita convers√µes inesperadas
- **Casos Especiais**: `Object.is()` trata casos extremos como NaN e ¬±0

‚öñÔ∏è Operador de Igualdade Solta (==)

**Comportamento:**
O operador `==` faz convers√£o de tipo (coercion) antes da compara√ß√£o, tentando tornar os operandos do mesmo tipo.

```javascript
// Exemplos b√°sicos
console.log(5 == 5);        // true
console.log("5" == 5);      // true (string convertida para number)
console.log(true == 1);     // true (boolean convertido para number)
console.log(false == 0);    // true (boolean convertido para number)
console.log("" == 0);       // true (string vazia convertida para 0)
console.log(null == undefined); // true (valores especiais)

// Convers√µes de array
console.log([1, 2] == "1,2"); // true (array convertido para string)
console.log([] == false);     // true (array vazia convertida para 0)

// Convers√µes de objeto
console.log({} == "[object Object]"); // true (objeto convertido para string)
console.log({} == false);     // false (objeto n√£o vazio √© truthy)
```

**Regras de Convers√£o:**

```javascript
// 1. Se os tipos s√£o iguais, compara diretamente
console.log(5 == 5);        // true
console.log("hello" == "hello"); // true

// 2. null e undefined s√£o iguais entre si
console.log(null == undefined); // true
console.log(null == null);      // true
console.log(undefined == undefined); // true

// 3. String e Number: converte string para number
console.log("42" == 42);    // true
console.log("3.14" == 3.14); // true
console.log("abc" == NaN);  // false (NaN nunca √© igual a nada)

// 4. Boolean e qualquer tipo: converte boolean para number
console.log(true == 1);     // true
console.log(false == 0);    // true
console.log(true == "1");   // true (true‚Üí1, "1"‚Üí1)
console.log(false == "");   // true (false‚Üí0, ""‚Üí0)

// 5. Object e primitivo: converte objeto para primitivo
console.log([1, 2, 3] == "1,2,3"); // true
console.log([1] == 1);      // true (array‚Üí"1", "1"‚Üí1)
console.log([] == 0);       // true (array‚Üí"", ""‚Üí0)
```

**Casos Problem√°ticos:**

```javascript
// Armadilhas comuns
console.log("0" == false);  // true (ambos convertidos para 0)
console.log("" == false);   // true (ambos convertidos para 0)
console.log("" == 0);       // true (ambos convertidos para 0)
console.log("" == [0]);     // true (array‚Üí"0", "0"‚Üí0, ""‚Üí0)

// Arrays vazios
console.log([] == false);   // true (array‚Üí"", ""‚Üí0, false‚Üí0)
console.log([] == 0);       // true (array‚Üí"", ""‚Üí0)
console.log([] == "");      // true (array‚Üí"")

// Objetos
console.log({} == false);   // false (objeto‚Üí"[object Object]", n√£o converte para 0)
console.log({} == "[object Object]"); // true
```

‚öñÔ∏è Operador de Igualdade Estrita (===)

**Comportamento:**
O operador `===` compara tanto o valor quanto o tipo dos operandos, sem fazer convers√£o de tipo.

```javascript
// Exemplos b√°sicos
console.log(5 === 5);       // true
console.log("5" === 5);     // false (tipos diferentes)
console.log(true === 1);    // false (tipos diferentes)
console.log(false === 0);   // false (tipos diferentes)
console.log("" === 0);      // false (tipos diferentes)
console.log(null === undefined); // false (valores diferentes)

// Arrays e objetos
console.log([1, 2] === [1, 2]); // false (refer√™ncias diferentes)
console.log({} === {});     // false (refer√™ncias diferentes)

// Strings
console.log("hello" === "hello"); // true
console.log("5" === "5");   // true
```

**Casos Especiais:**

```javascript
// NaN nunca √© igual a nada, nem a si mesmo
console.log(NaN === NaN);   // false
console.log(Number.NaN === Number.NaN); // false

// ¬±0 s√£o considerados iguais
console.log(+0 === -0);     // true
console.log(0 === -0);      // true

// null e undefined
console.log(null === null); // true
console.log(undefined === undefined); // true
console.log(null === undefined); // false
```

**Compara√ß√£o com == vs ===:**

```javascript
// Exemplos comparativos
let valor = "5";

console.log(valor == 5);    // true (convers√£o de tipo)
console.log(valor === 5);   // false (sem convers√£o)

let booleano = true;
console.log(booleano == 1); // true (true ‚Üí 1)
console.log(booleano === 1); // false (boolean !== number)

let array = [1, 2];
console.log(array == "1,2"); // true (array ‚Üí string)
console.log(array === "1,2"); // false (array !== string)
```

üî¨ Object.is() - Igualdade Mesmo Valor

**Comportamento:**
`Object.is()` determina se dois valores s√£o o mesmo valor, tratando casos especiais como NaN e ¬±0 de forma diferente do `===`.

```javascript
// Casos b√°sicos (mesmo comportamento do ===)
console.log(Object.is(5, 5));           // true
console.log(Object.is("5", 5));         // false
console.log(Object.is(true, 1));        // false
console.log(Object.is([], []));         // false

// Casos especiais onde Object.is() difere do ===

// 1. NaN √© igual a NaN
console.log(NaN === NaN);               // false
console.log(Object.is(NaN, NaN));       // true

// 2. +0 e -0 s√£o diferentes
console.log(+0 === -0);                 // true
console.log(Object.is(+0, -0));         // false

// 3. Outros casos s√£o iguais ao ===
console.log(null === undefined);        // false
console.log(Object.is(null, undefined)); // false

console.log("hello" === "hello");       // true
console.log(Object.is("hello", "hello")); // true
```

**Implementa√ß√£o de Object.is():**

```javascript
// Como Object.is() funciona internamente
function meuObjectIs(x, y) {
  if (x === y) {
    // Trata o caso especial de +0 e -0
    return x !== 0 || 1 / x === 1 / y;
  } else {
    // Trata o caso especial de NaN
    return x !== x && y !== y;
  }
}

// Teste da implementa√ß√£o
console.log(meuObjectIs(NaN, NaN));     // true
console.log(meuObjectIs(+0, -0));       // false
console.log(meuObjectIs(5, 5));         // true
console.log(meuObjectIs("5", 5));       // false
```

**Casos de Uso para Object.is():**

```javascript
// 1. Verifica√ß√£o de NaN
function verificarNaN(valor) {
  return Object.is(valor, NaN);
}

console.log(verificarNaN(NaN));         // true
console.log(verificarNaN(5));           // false
console.log(verificarNaN("abc"));       // false

// 2. Verifica√ß√£o de zero negativo
function verificarZeroNegativo(valor) {
  return Object.is(valor, -0);
}

console.log(verificarZeroNegativo(-0)); // true
console.log(verificarZeroNegativo(0));  // false
console.log(verificarZeroNegativo(5));  // false

// 3. Compara√ß√£o precisa em algoritmos matem√°ticos
function calcularInverso(valor) {
  if (Object.is(valor, 0)) {
    return Infinity;
  } else if (Object.is(valor, -0)) {
    return -Infinity;
  }
  return 1 / valor;
}

console.log(calcularInverso(0));        // Infinity
console.log(calcularInverso(-0));       // -Infinity
console.log(calcularInverso(2));        // 0.5
```

üìä Algoritmos de Igualdade

**1. isLooselyEqual (==)**
Compara valores com convers√£o de tipo.

```javascript
// Algoritmo isLooselyEqual
function isLooselyEqual(x, y) {
  // Se os tipos s√£o iguais, usa compara√ß√£o estrita
  if (typeof x === typeof y) {
    return x === y;
  }
  
  // Casos especiais
  if (x == null && y == null) return true;
  if (x == null || y == null) return false;
  
  // Convers√µes de tipo
  if (typeof x === 'string' && typeof y === 'number') {
    return Number(x) === y;
  }
  if (typeof x === 'number' && typeof y === 'string') {
    return x === Number(y);
  }
  if (typeof x === 'boolean') {
    return isLooselyEqual(Number(x), y);
  }
  if (typeof y === 'boolean') {
    return isLooselyEqual(x, Number(y));
  }
  
  // Convers√£o de objetos
  if (typeof x === 'object') {
    return isLooselyEqual(x.toString(), y);
  }
  if (typeof y === 'object') {
    return isLooselyEqual(x, y.toString());
  }
  
  return false;
}

// Teste
console.log(isLooselyEqual("5", 5));    // true
console.log(isLooselyEqual(true, 1));   // true
console.log(isLooselyEqual([1], 1));    // true
```

**2. isStrictlyEqual (===)**
Compara valores e tipos sem convers√£o.

```javascript
// Algoritmo isStrictlyEqual
function isStrictlyEqual(x, y) {
  // Se os tipos s√£o diferentes, retorna false
  if (typeof x !== typeof y) {
    return false;
  }
  
  // Para n√∫meros, trata casos especiais
  if (typeof x === 'number') {
    if (x !== x && y !== y) return true;  // NaN
    if (x === 0 && y === 0) return 1/x === 1/y; // ¬±0
  }
  
  return x === y;
}

// Teste
console.log(isStrictlyEqual(5, 5));     // true
console.log(isStrictlyEqual("5", 5));   // false
console.log(isStrictlyEqual(NaN, NaN)); // true
console.log(isStrictlyEqual(+0, -0));   // true
```

**3. SameValueZero**
Usado em estruturas como Set e Map, trata ¬±0 como iguais.

```javascript
// Algoritmo SameValueZero
function sameValueZero(x, y) {
  if (typeof x === 'number' && typeof y === 'number') {
    if (x !== x && y !== y) return true;  // NaN
    return x === y; // ¬±0 s√£o iguais
  }
  return x === y;
}

// Teste
console.log(sameValueZero(NaN, NaN));   // true
console.log(sameValueZero(+0, -0));     // true
console.log(sameValueZero(5, 5));       // true
console.log(sameValueZero("5", 5));     // false
```

**4. SameValue (Object.is)**
Trata ¬±0 como diferentes e NaN como iguais.

```javascript
// Algoritmo SameValue
function sameValue(x, y) {
  if (typeof x === 'number' && typeof y === 'number') {
    if (x !== x && y !== y) return true;  // NaN
    if (x === 0 && y === 0) return 1/x === 1/y; // ¬±0
  }
  return x === y;
}

// Teste
console.log(sameValue(NaN, NaN));       // true
console.log(sameValue(+0, -0));         // false
console.log(sameValue(5, 5));           // true
```

üéØ Compara√ß√£o dos Algoritmos

| Algoritmo | NaN | ¬±0 | Convers√£o de Tipo | Uso |
|-----------|-----|----|-------------------|-----|
| **isLooselyEqual** | false | iguais | Sim | `==` |
| **isStrictlyEqual** | false | iguais | N√£o | `===` |
| **SameValueZero** | iguais | iguais | N√£o | Set, Map |
| **SameValue** | iguais | diferentes | N√£o | `Object.is()` |

**Exemplos Pr√°ticos:**

```javascript
// 1. Set usa SameValueZero
let set = new Set();
set.add(0);
set.add(-0);
console.log(set.size); // 1 (mesmo valor)

// 2. Map usa SameValueZero
let map = new Map();
map.set(0, "zero");
map.set(-0, "zero negativo");
console.log(map.size); // 1 (mesmo valor)

// 3. Array.includes() usa SameValueZero
let array = [0, NaN];
console.log(array.includes(-0)); // true
console.log(array.includes(NaN)); // true

// 4. indexOf() usa Strict Equality
console.log(array.indexOf(-0)); // 0
console.log(array.indexOf(NaN)); // -1 (n√£o encontrado)
```

üö® Armadilhas Comuns e Como Evit√°-las

**1. Compara√ß√µes com Arrays:**

```javascript
// ‚ùå Problema
let array = [1, 2, 3];
if (array == "1,2,3") {
  console.log("Arrays s√£o iguais!");
}

// ‚úÖ Solu√ß√£o
if (array.toString() === "1,2,3") {
  console.log("Arrays s√£o iguais!");
}

// Ou melhor ainda
if (JSON.stringify(array) === JSON.stringify([1, 2, 3])) {
  console.log("Arrays s√£o iguais!");
}
```

**2. Compara√ß√µes com Objetos:**

```javascript
// ‚ùå Problema
let obj1 = {nome: "Jo√£o"};
let obj2 = {nome: "Jo√£o"};
if (obj1 == obj2) {
  console.log("Objetos s√£o iguais!");
}

// ‚úÖ Solu√ß√£o
if (JSON.stringify(obj1) === JSON.stringify(obj2)) {
  console.log("Objetos s√£o iguais!");
}

// Ou para compara√ß√£o profunda
function objetosIguais(obj1, obj2) {
  return JSON.stringify(obj1) === JSON.stringify(obj2);
}
```

**3. Compara√ß√µes com Boolean:**

```javascript
// ‚ùå Problema
let valor = "true";
if (valor == true) {
  console.log("Valor √© verdadeiro!");
}

// ‚úÖ Solu√ß√£o
if (valor === "true") {
  console.log("Valor √© verdadeiro!");
}

// Ou para verificar se √© truthy
if (Boolean(valor)) {
  console.log("Valor √© truthy!");
}
```

**4. Compara√ß√µes com null/undefined:**

```javascript
// ‚ùå Problema
let valor = null;
if (valor == undefined) {
  console.log("Valor √© null ou undefined!");
}

// ‚úÖ Solu√ß√£o
if (valor === null || valor === undefined) {
  console.log("Valor √© null ou undefined!");
}

// Ou mais conciso
if (valor == null) {
  console.log("Valor √© null ou undefined!");
}
```

üí° Boas Pr√°ticas

**1. Use === por padr√£o:**
```javascript
// ‚úÖ Recomendado
if (valor === 5) { }
if (nome === "Jo√£o") { }
if (ativo === true) { }

// ‚ùå Evite
if (valor == 5) { }
if (nome == "Jo√£o") { }
if (ativo == true) { }
```

**2. Use == apenas quando necess√°rio:**
```javascript
// ‚úÖ Casos v√°lidos para ==
if (valor == null) { } // null ou undefined
if (typeof valor == "string") { } // verifica√ß√£o de tipo

// ‚ùå Evite convers√µes inesperadas
if (array == "1,2,3") { }
if (objeto == "[object Object]") { }
```

**3. Use Object.is() para casos especiais:**
```javascript
// ‚úÖ Para NaN
if (Object.is(valor, NaN)) { }

// ‚úÖ Para zero negativo
if (Object.is(valor, -0)) { }

// ‚úÖ Para compara√ß√µes precisas
if (Object.is(resultado, esperado)) { }
```

**4. Implemente compara√ß√µes personalizadas quando necess√°rio:**
```javascript
// Compara√ß√£o profunda de objetos
function comparacaoProfunda(obj1, obj2) {
  if (obj1 === obj2) return true;
  if (obj1 == null || obj2 == null) return false;
  if (typeof obj1 !== typeof obj2) return false;
  
  if (typeof obj1 === 'object') {
    const keys1 = Object.keys(obj1);
    const keys2 = Object.keys(obj2);
    
    if (keys1.length !== keys2.length) return false;
    
    return keys1.every(key => 
      keys2.includes(key) && comparacaoProfunda(obj1[key], obj2[key])
    );
  }
  
  return obj1 === obj2;
}

// Teste
let obj1 = {a: 1, b: {c: 2}};
let obj2 = {a: 1, b: {c: 2}};
console.log(comparacaoProfunda(obj1, obj2)); // true
```

---

**üí° Dica Profissional**: Sempre use `===` como padr√£o. Use `==` apenas quando voc√™ realmente precisa de convers√£o de tipo (como verificar `null` ou `undefined`). Use `Object.is()` para casos especiais como `NaN` e zero negativo.

**‚è±Ô∏è Tempo estimado de estudo**: 2-3 horas
**üèÜ N√≠vel**: Intermedi√°rio
**üìù Tags**: #javascript #compara√ß√µes #igualdade #operadores #=== #== #Object.is